
#database connection settings
Type: mysql
URL: dnsfilter:rahasiadns@(175.106.8.72:3306)/dnsfilter

#sql commands used in application
SQLCommand:

  GetTotalDns: >
    select COUNT(id) total from dns

  GetTotalBlok: >
    select COUNT(id) total from blok

  GetTotalDnsBlok: >
    SELECT count(dns.id) AS total 
    FROM dns JOIN blok ON dns.base_domain = blok.`name` WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW())

  GetTotalIpAddress: >
    SELECT COUNT(*) AS total FROM (SELECT COUNT(ip_address) AS cou FROM dns 
    WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW()) GROUP BY ip_address HAVING cou>1 ) AS total

  GetTotalMostActiveList: >
    SELECT base_domain, count(base_domain) total_most_active 
    from dns WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW()) GROUP BY base_domain ORDER BY total_most_active DESC LIMIT 10

  GetTotalDnsDayList: >
    SELECT DAYNAME(DATE(log_datetime)) AS dayname, COUNT(1) as total
    FROM dns WHERE DATE(log_datetime) > (NOW() - INTERVAL 3 DAY) Group by DATE(log_datetime) limit 7

  GetTotalIpAddressDayList: >
    SELECT DAYNAME(DATE(log_datetime)) AS dayname, COUNT(DISTINCT(ip_address)) as total
    FROM dns WHERE DATE(log_datetime) > (NOW() - INTERVAL 7 DAY) Group by DATE(log_datetime) limit 7

  GetBlokList: >
    SELECT dns.id AS blok_id, dns.domain, dns.base_domain, dns.ip_address, dns.has_subdomain, blok_category.`name` AS blok_category_name, blok.`name` AS blok_name , dns.log_datetime, dns.created_at 
    FROM dns JOIN blok ON dns.base_domain = blok.`name` JOIN blok_category ON blok_category.id = blok.category_blok_id WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW()) LIMIT 25

  GetIpAddressBlokCategoryDayList: >
    SELECT blok_category.name AS categoryname, COUNT(DISTINCT(dns.ip_address)) AS total
    FROM dns JOIN blok ON blok.`name` = dns.base_domain JOIN blok_category ON blok_category.id = blok.category_blok_id WHERE DATE(dns.log_datetime) > (NOW() - INTERVAL 3 DAY) GROUP BY categoryname
    
  GetDnsBlokCategoryDayList: >
    SELECT blok_category.name AS categoryname, COUNT(dns.id) AS total
    FROM dns JOIN blok ON blok.`name` = dns.base_domain JOIN blok_category ON blok_category.id = blok.category_blok_id WHERE DATE(dns.log_datetime) > (NOW() - INTERVAL 3 DAY) GROUP BY categoryname