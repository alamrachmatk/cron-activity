
#database connection settings
Type: mysql
URL: dnsfilter:rahasiadns@(175.106.8.72:3306)/dnsfilter

#sql commands used in application
SQLCommand:

  GetTotalDns: >
    select COUNT(id) total from dns

  GetTotalBlock: >
    select COUNT(id) total from block

  GetTotalDnsBlock: >
    SELECT count(dns.id) AS total 
    FROM dns JOIN block ON dns.base_domain = block.`name` WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW())

  GetTotalIpAddress: >
    SELECT COUNT(*) AS total FROM (SELECT COUNT(ip_address) AS cou FROM dns 
    WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW()) GROUP BY ip_address HAVING cou>1 ) AS total

  GetTotalMostActiveList: >
    SELECT base_domain, count(base_domain) total_most_active 
    from dns WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW()) GROUP BY base_domain ORDER BY total_most_active DESC LIMIT 10

  GetTotalDnsDayList: >
    SELECT DAYNAME(DATE(log_datetime)) AS dayname, COUNT(1) as total
    FROM dns WHERE DATE(log_datetime) > (NOW() - INTERVAL 3 DAY) Group by DATE(log_datetime) limit 7

  GetTotalIpAddressDayList: >
    SELECT DAYNAME(DATE(log_datetime)) AS dayname, COUNT(DISTINCT(ip_address)) as total
    FROM dns WHERE DATE(log_datetime) > (NOW() - INTERVAL 7 DAY) Group by DATE(log_datetime) limit 7

  GetBlockList: >
    SELECT dns.id AS block_id, dns.domain, dns.base_domain, dns.ip_address, dns.has_subdomain, block_category.`name` AS block_category_name, block.`name` AS block_name , dns.log_datetime, dns.created_at 
    FROM dns JOIN block ON dns.base_domain = block.`name` JOIN block_category ON block_category.id = block.category_block_id WHERE WEEKOFYEAR(log_datetime) = WEEKOFYEAR(NOW()) LIMIT 25

  GetIpAddressBlockCategoryDayList: >
    SELECT block_category.name AS categoryname, COUNT(DISTINCT(dns.ip_address)) AS total
    FROM dns JOIN block ON block.`name` = dns.base_domain JOIN block_category ON block_category.id = block.category_block_id WHERE DATE(dns.log_datetime) > (NOW() - INTERVAL 3 DAY) GROUP BY categoryname
    
  GetDnsBlockCategoryDayList: >
    SELECT block_category.name AS categoryname, COUNT(dns.id) AS total
    FROM dns JOIN block ON block.`name` = dns.base_domain JOIN block_category ON block_category.id = block.category_block_id WHERE DATE(dns.log_datetime) > (NOW() - INTERVAL 3 DAY) GROUP BY categoryname